---
import MainLayout from '@/layouts/main.astro';
import { getCollection, getEntry, render } from 'astro:content';
import { Markdown } from '@astropub/md';

// Get the slug from the URL
const { slug } = Astro.params;

// Get the dog entry from content collection
const dogEntry = await getEntry('dogs', slug as string);

// If dog not found, show 404
if (!dogEntry) {
	return Astro.redirect('/404');
}

const dog = dogEntry.data;
const markdownBody = dogEntry.body || '';

// Generate static paths for all dogs
export async function getStaticPaths() {
	const dogs = await getCollection('dogs');
	return dogs.map((dog) => ({
		params: { slug: dog.id },
	}));
}
---

<MainLayout title={dog.name} description={`Adoptujte si ${dog.name} - ${dog.breed}`}>
	<!-- Header Section -->
	<section id="header" class="header-section">
		<div class="mx-auto max-w-screen-2xl px-4 py-8">
			<div class="max-w-6xl mx-auto">
				<a href="/psici" class="text-primary hover:underline mb-4 inline-block">
					‚Üê Sp√§≈• na v≈°etk√Ωch ps√≠kov
				</a>
				<div class="flex items-center gap-4 mt-4 flex-wrap">
					<h1 class="text-4xl md:text-5xl font-bold">{dog.name}</h1>
					<div class="flex gap-2 flex-wrap">
						{dog.urgent && (
							<span class="bg-red-600 text-white px-4 py-2 rounded-full text-sm font-bold">
								‚ö†Ô∏è URGENTN√â
							</span>
						)}
						{dog.specialNeeds && (
							<span class="bg-amber-600 text-white px-4 py-2 rounded-full text-sm font-bold">
								üíô ≈†peci√°lne potreby
							</span>
						)}
						{dog.featured && (
							<span class="bg-purple-600 text-white px-4 py-2 rounded-full text-sm font-bold">
								‚≠ê Odpor√∫ƒçan√Ω
							</span>
						)}
					</div>
				</div>
				<p class="text-xl text-muted-foreground mt-4">{dog.description}</p>
			</div>
		</div>
	</section>

	<!-- Photo Gallery Section -->
	{dog.images && dog.images.length > 0 ? (
		<section id="gallery" class="gallery-section">
			<div class="mx-auto max-w-screen-2xl px-4 py-8">
				<div class="max-w-6xl mx-auto">
					<!-- Main Image -->
					<div class="mb-4 flex justify-center bg-muted/20 rounded-lg">
						<img
							id="main-image"
							src={dog.images[0]}
							alt={`${dog.name} - hlavn√° fotka`}
							class="w-full h-auto max-h-[700px] object-contain rounded-lg shadow-lg"
						/>
					</div>
					<!-- Thumbnail Gallery -->
					<div class="grid grid-cols-4 md:grid-cols-6 lg:grid-cols-8 gap-2">
						{dog.images.map((image, index) => (
							<button
								class="thumbnail-btn overflow-hidden rounded-lg border-2 border-transparent hover:border-primary transition-all cursor-pointer"
								data-image={image}
							>
								<img
									src={image}
									alt={`${dog.name} - fotka ${index + 1}`}
									class="w-full h-20 object-cover"
								/>
							</button>
						))}
					</div>
				</div>
			</div>
		</section>
	) : (
		<section id="single-photo" class="single-photo-section">
			<div class="mx-auto max-w-screen-2xl px-4 py-8">
				<div class="max-w-6xl mx-auto flex justify-center bg-muted/20 rounded-lg">
					<img
						src={dog.image}
						alt={dog.name}
						class="w-full h-auto max-h-[700px] object-contain rounded-lg shadow-lg"
					/>
				</div>
			</div>
		</section>
	)}

	<!-- Video Section -->
	{dog.videoUrl && (
		<section id="video" class="video-section">
			<div class="mx-auto max-w-screen-2xl px-4 py-8">
				<div class="max-w-6xl mx-auto">
					<h2 class="text-3xl font-bold mb-6">üìπ Video</h2>
					<div class="aspect-video">
						<iframe
							src={dog.videoUrl}
							class="w-full h-full rounded-lg shadow-lg"
							allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
							allowfullscreen
						></iframe>
					</div>
				</div>
			</div>
		</section>
	)}

	<!-- Main Info Section -->
	<section id="main-info" class="main-info-section">
		<div class="mx-auto max-w-screen-2xl px-4 py-8">
			<div class="max-w-6xl mx-auto">
				<div class="grid lg:grid-cols-[320px_1fr] gap-8">
					<!-- Left Sidebar - Basic Info & Health -->
					<div class="space-y-6">
						<!-- Basic Information -->
						<div class="p-6 rounded-lg bg-card border border-border">
							<h2 class="text-2xl font-semibold mb-4">üìã Z√°kladn√© inform√°cie</h2>
							<dl class="space-y-3">
								<div class="flex justify-between border-b border-border pb-2">
									<dt class="font-medium">Plemeno:</dt>
									<dd class="text-muted-foreground">{dog.breed}</dd>
								</div>
								<div class="flex justify-between border-b border-border pb-2">
									<dt class="font-medium">Vek:</dt>
									<dd class="text-muted-foreground">{dog.age}</dd>
								</div>
								<div class="flex justify-between border-b border-border pb-2">
									<dt class="font-medium">Pohlavie:</dt>
									<dd class="text-muted-foreground">{dog.gender}</dd>
								</div>
								{dog.size && (
									<div class="flex justify-between border-b border-border pb-2">
										<dt class="font-medium">Veƒækos≈•:</dt>
										<dd class="text-muted-foreground">{dog.size}</dd>
									</div>
								)}
								{dog.weight && (
									<div class="flex justify-between border-b border-border pb-2">
										<dt class="font-medium">Hmotnos≈•:</dt>
										<dd class="text-muted-foreground">{dog.weight}</dd>
									</div>
								)}
								{dog.color && (
									<div class="flex justify-between border-b border-border pb-2">
										<dt class="font-medium">Farba:</dt>
										<dd class="text-muted-foreground">{dog.color}</dd>
									</div>
								)}
								{dog.energyLevel && (
									<div class="flex justify-between border-b border-border pb-2">
										<dt class="font-medium">√örove≈à energie:</dt>
										<dd class="text-muted-foreground">{dog.energyLevel}</dd>
									</div>
								)}
								{dog.arrivalDate && (
									<div class="flex justify-between border-b border-border pb-2">
										<dt class="font-medium">V √∫tulku od:</dt>
										<dd class="text-muted-foreground">{dog.arrivalDate}</dd>
									</div>
								)}
								{dog.chipNumber && (
									<div class="flex justify-between pb-2">
										<dt class="font-medium">ƒå√≠slo ƒçipu:</dt>
										<dd class="text-muted-foreground text-xs">{dog.chipNumber}</dd>
									</div>
								)}
							</dl>
						</div>

						<!-- Health Status -->
						<div class="p-6 rounded-lg bg-card border border-border">
							<h2 class="text-2xl font-semibold mb-4">üè• Zdravie</h2>
							<div class="space-y-3 mb-4">
								<div class="flex items-center gap-2">
									<span class={dog.vaccinated ? 'text-green-600 text-xl' : 'text-gray-400 text-xl'}>
										{dog.vaccinated ? '‚úì' : '‚óã'}
									</span>
									<span>Oƒçkovan√Ω</span>
								</div>
								<div class="flex items-center gap-2">
									<span class={dog.sterilized ? 'text-green-600 text-xl' : 'text-gray-400 text-xl'}>
										{dog.sterilized ? '‚úì' : '‚óã'}
									</span>
									<span>Kastrovan√Ω/Sterilizovan√°</span>
								</div>
								<div class="flex items-center gap-2">
									<span class={dog.chipped ? 'text-green-600 text-xl' : 'text-gray-400 text-xl'}>
										{dog.chipped ? '‚úì' : '‚óã'}
									</span>
									<span>ƒåipovan√Ω</span>
								</div>
								<div class="flex items-center gap-2">
									<span class={dog.dewormed ? 'text-green-600 text-xl' : 'text-gray-400 text-xl'}>
										{dog.dewormed ? '‚úì' : '‚óã'}
									</span>
									<span>Odƒçerven√Ω</span>
								</div>
							</div>
							{dog.health && (
								<div class="mt-4 pt-4 border-t border-border">
									<p class="text-sm text-muted-foreground">{dog.health}</p>
								</div>
							)}
							{dog.healthIssues && (
								<div class="mt-4 pt-4 border-t border-border bg-amber-50 dark:bg-amber-950/20 -m-6 mt-4 p-6 rounded-b-lg">
									<p class="text-sm"><strong>Zdravotn√© pozn√°mky:</strong> {dog.healthIssues}</p>
								</div>
							)}
							{dog.medications && dog.medications.length > 0 && (
								<div class="mt-2">
									<p class="text-sm font-medium mb-1">Lieky:</p>
									<ul class="text-sm text-muted-foreground list-disc list-inside">
										{dog.medications.map((med) => <li>{med}</li>)}
									</ul>
								</div>
							)}
							{dog.dietaryNeeds && (
								<div class="mt-2">
									<p class="text-sm"><strong>Strava:</strong> {dog.dietaryNeeds}</p>
								</div>
							)}
						</div>
					</div>

					<!-- Main Content - Flowing Information -->
					<div class="space-y-8">
						<!-- Personality & Character -->
						{dog.personality && (
							<div>
								<h2 class="text-3xl font-bold mb-4">üí≠ Povaha a charakter</h2>
								<p class="text-lg leading-relaxed text-muted-foreground">{dog.personality}</p>
							</div>
						)}

						{dog.characteristics && dog.characteristics.length > 0 && (
							<div>
								<h2 class="text-3xl font-bold mb-4">‚≠ê Charakteristika</h2>
								<ul class="grid md:grid-cols-2 gap-3">
									{dog.characteristics.map((char) => (
										<li class="flex items-start gap-2">
											<span class="text-primary text-xl mt-0.5">‚Ä¢</span>
											<span class="text-lg">{char}</span>
										</li>
									))}
								</ul>
							</div>
						)}

						<!-- Compatibility -->
						<div>
							<h2 class="text-3xl font-bold mb-4">üë• Vhodnos≈• a kompatibilita</h2>
							<div class="grid md:grid-cols-2 gap-4">
								{dog.goodWithKids !== undefined && (
									<div class="flex items-start gap-3 p-4 rounded-lg bg-card border border-border">
										<span class={dog.goodWithKids ? 'text-green-600 text-3xl' : 'text-red-600 text-3xl'}>
											{dog.goodWithKids ? '‚úì' : '‚úó'}
										</span>
										<div>
											<span class="font-semibold text-lg">Vhodn√Ω pre deti</span>
											{dog.kidsAgeRecommendation && (
												<p class="text-sm text-muted-foreground mt-1">{dog.kidsAgeRecommendation}</p>
											)}
										</div>
									</div>
								)}
								{dog.goodWithDogs !== undefined && (
									<div class="flex items-start gap-3 p-4 rounded-lg bg-card border border-border">
										<span class={dog.goodWithDogs ? 'text-green-600 text-3xl' : 'text-red-600 text-3xl'}>
											{dog.goodWithDogs ? '‚úì' : '‚úó'}
										</span>
										<span class="font-semibold text-lg">Vhodn√Ω k in√Ωm psom</span>
									</div>
								)}
								{dog.goodWithCats !== undefined && (
									<div class="flex items-start gap-3 p-4 rounded-lg bg-card border border-border">
										<span class={dog.goodWithCats ? 'text-green-600 text-3xl' : 'text-red-600 text-3xl'}>
											{dog.goodWithCats ? '‚úì' : '‚úó'}
										</span>
										<span class="font-semibold text-lg">Vhodn√Ω k maƒçk√°m</span>
									</div>
								)}
								{dog.goodWithOtherPets !== undefined && (
									<div class="flex items-start gap-3 p-4 rounded-lg bg-card border border-border">
										<span class={dog.goodWithOtherPets ? 'text-green-600 text-3xl' : 'text-red-600 text-3xl'}>
											{dog.goodWithOtherPets ? '‚úì' : '‚úó'}
										</span>
										<span class="font-semibold text-lg">Vhodn√Ω k in√Ωm zvierat√°m</span>
									</div>
								)}
							</div>
						</div>

						{/* Training */}
						{(dog.houseTrained !== undefined || dog.leashTrained !== undefined || (dog.commands && dog.commands.length > 0) || dog.trainingNeeds) && (
							<div>
								<h2 class="text-3xl font-bold mb-4">üéì V√Ωcvik a zruƒçnosti</h2>
								<div class="space-y-4">
									<div class="grid md:grid-cols-2 gap-4">
										{dog.houseTrained !== undefined && (
											<div class="flex items-center gap-3 p-4 rounded-lg bg-card border border-border">
												<span class={dog.houseTrained ? 'text-green-600 text-2xl' : 'text-gray-400 text-2xl'}>
													{dog.houseTrained ? '‚úì' : '‚óã'}
												</span>
												<span class="font-semibold">ƒåistotn√Ω</span>
											</div>
										)}
										{dog.leashTrained !== undefined && (
											<div class="flex items-center gap-3 p-4 rounded-lg bg-card border border-border">
												<span class={dog.leashTrained ? 'text-green-600 text-2xl' : 'text-gray-400 text-2xl'}>
													{dog.leashTrained ? '‚úì' : '‚óã'}
												</span>
												<span class="font-semibold">Chod√≠ na vod√≠tku</span>
											</div>
										)}
									</div>
									{dog.commands && dog.commands.length > 0 && (
										<div class="p-4 rounded-lg bg-card border border-border">
											<p class="font-semibold mb-3">Ovl√°da povely:</p>
											<div class="flex flex-wrap gap-2">
												{dog.commands.map((cmd) => (
													<span class="px-4 py-2 bg-primary/10 text-primary rounded-full font-medium">
														{cmd}
													</span>
												))}
											</div>
										</div>
									)}
									{dog.trainingNeeds && (
										<p class="text-muted-foreground leading-relaxed">{dog.trainingNeeds}</p>
									)}
								</div>
							</div>
						)}

						{/* Living Requirements */}
						{(dog.exerciseNeeds || dog.spaceNeeds || dog.timeCommitment || dog.experienceRequired || dog.aloneTimeTolerance || dog.groomingNeeds) && (
							<div>
								<h2 class="text-3xl font-bold mb-4">üè° ≈Ωivotn√© potreby</h2>
								<div class="grid md:grid-cols-2 gap-4">
									{dog.exerciseNeeds && (
										<div class="p-4 rounded-lg bg-card border border-border">
											<dt class="font-semibold text-sm text-muted-foreground mb-1">Potreba pohybu:</dt>
											<dd class="text-lg">{dog.exerciseNeeds}</dd>
										</div>
									)}
									{dog.spaceNeeds && (
										<div class="p-4 rounded-lg bg-card border border-border">
											<dt class="font-semibold text-sm text-muted-foreground mb-1">Priestor:</dt>
											<dd class="text-lg">{dog.spaceNeeds}</dd>
										</div>
									)}
									{dog.timeCommitment && (
										<div class="p-4 rounded-lg bg-card border border-border">
											<dt class="font-semibold text-sm text-muted-foreground mb-1">ƒåasov√° n√°roƒçnos≈•:</dt>
											<dd class="text-lg">{dog.timeCommitment}</dd>
										</div>
									)}
									{dog.experienceRequired && (
										<div class="p-4 rounded-lg bg-card border border-border">
											<dt class="font-semibold text-sm text-muted-foreground mb-2">Potrebn√© sk√∫senosti:</dt>
											<dd>
												<span class={`px-4 py-2 rounded-full font-medium inline-block ${
													dog.experienceRequired === 'Zaƒçiatoƒçn√≠k' ? 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200' :
													dog.experienceRequired === 'Stredne pokroƒçil√Ω' ? 'bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200' :
													'bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200'
												}`}>
													{dog.experienceRequired}
												</span>
											</dd>
										</div>
									)}
									{dog.aloneTimeTolerance && (
										<div class="p-4 rounded-lg bg-card border border-border">
											<dt class="font-semibold text-sm text-muted-foreground mb-1">Tolerancia samoty:</dt>
											<dd class="text-lg">{dog.aloneTimeTolerance}</dd>
										</div>
									)}
									{dog.groomingNeeds && (
										<div class="p-4 rounded-lg bg-card border border-border">
											<dt class="font-semibold text-sm text-muted-foreground mb-1">Starostlivos≈• o srs≈•:</dt>
											<dd class="text-lg">{dog.groomingNeeds}</dd>
										</div>
									)}
								</div>
							</div>
						)}

						{/* Ideal Home */}
						{dog.idealFamily && (
							<div class="p-6 rounded-lg bg-primary/5 border-2 border-primary/20">
								<h2 class="text-3xl font-bold mb-4">üíö Ide√°lny domov pre m≈àa</h2>
								<p class="text-lg leading-relaxed">{dog.idealFamily}</p>
							</div>
						)}

						{/* Why Adopt Me */}
						{dog.whyAdoptMe && dog.whyAdoptMe.length > 0 && (
							<div class="p-6 rounded-lg bg-secondary/10 border border-secondary/20">
								<h2 class="text-3xl font-bold mb-4">‚ù§Ô∏è Preƒço si ma adoptova≈•?</h2>
								<ul class="space-y-3">
									{dog.whyAdoptMe.map((reason) => (
										<li class="flex items-start gap-3">
											<span class="text-primary text-2xl mt-0.5">‚Ä¢</span>
											<span class="text-lg">{reason}</span>
										</li>
									))}
								</ul>
							</div>
						)}

						{/* Adoption Info */}
						{(dog.adoptionFee || (dog.specialRequirements && dog.specialRequirements.length > 0)) && (
							<div>
								<h2 class="text-3xl font-bold mb-4">üìù Inform√°cie o adopcii</h2>
								<div class="space-y-4">
									{dog.adoptionFee && (
										<div class="p-6 rounded-lg bg-card border border-border">
											<p class="text-sm text-muted-foreground mb-2">Adopƒçn√Ω poplatok:</p>
											<p class="text-3xl font-bold text-primary">{dog.adoptionFee} ‚Ç¨</p>
											<p class="text-sm text-muted-foreground mt-2">Poplatok zah≈ï≈àa oƒçkovanie, ƒçipovanie, kastr√°ciu/steriliz√°ciu a veterin√°rnu starostlivos≈•</p>
										</div>
									)}
									{dog.specialRequirements && dog.specialRequirements.length > 0 && (
										<div class="p-6 rounded-lg bg-amber-50 dark:bg-amber-950/20 border border-amber-200 dark:border-amber-800">
											<p class="font-semibold mb-3">≈†peci√°lne po≈æiadavky pre adopciu:</p>
											<ul class="space-y-2">
												{dog.specialRequirements.map((req) => (
													<li class="flex items-start gap-2">
														<span class="text-primary text-xl mt-0.5">‚Üí</span>
														<span>{req}</span>
													</li>
												))}
											</ul>
										</div>
									)}
								</div>
							</div>
						)}
					</div>
				</div>
			</div>
		</div>
	</section>

	<!-- Story/Description Section -->
	{markdownBody && (
		<section id="story" class="story-section bg-muted/30">
			<div class="mx-auto max-w-screen-2xl px-4 py-16">
				<div class="max-w-4xl mx-auto prose prose-lg dark:prose-invert">
					<div set:html={markdownBody} />
				</div>
			</div>
		</section>
	)}

	<!-- CTA Section -->
	<section id="cta" class="cta-section">
		<div class="mx-auto max-w-screen-2xl px-4 py-16">
			<div class="max-w-4xl mx-auto bg-primary/10 border border-primary/20 rounded-lg p-8 md:p-12 text-center">
				<h2 class="text-3xl md:text-4xl font-bold mb-4">Chcete adoptova≈• {dog.name}?</h2>
				<p class="text-lg text-muted-foreground mb-8">
					{dog.name} ƒçak√° na svoj nov√Ω domov pln√Ω l√°sky. Nav≈°t√≠vte n√°s v √∫tulku alebo n√°s kontaktujte pre viac inform√°ci√≠ o adopcii.
				</p>
				<div class="flex flex-col sm:flex-row gap-4 justify-center">
					<a
						href="/adopcia"
						class="inline-flex items-center justify-center px-8 py-4 rounded-md bg-primary text-primary-foreground hover:bg-primary/90 transition-colors font-semibold text-lg"
					>
						Ako adoptova≈•
					</a>
					<a
						href="/kontakt"
						class="inline-flex items-center justify-center px-8 py-4 rounded-md bg-secondary text-secondary-foreground hover:bg-secondary/90 transition-colors font-semibold text-lg"
					>
						Kontaktujte n√°s
					</a>
				</div>
				<div class="mt-8 pt-8 border-t border-border">
					<p class="text-sm text-muted-foreground">
						<strong>Otv√°racie hodiny:</strong> Pondelok - Nedeƒæa, 10:00 - 16:00<br />
						<strong>Telef√≥n:</strong> <a href="tel:+421915785007" class="text-primary hover:underline">+421 915 785 007</a>
					</p>
				</div>
			</div>
		</div>
	</section>

	<!-- Photo Gallery JavaScript -->
	<script>
		// Photo gallery functionality
		const mainImage = document.getElementById('main-image');
		const thumbnailButtons = document.querySelectorAll('.thumbnail-btn');

		thumbnailButtons.forEach((button) => {
			button.addEventListener('click', () => {
				const newImage = button.getAttribute('data-image');
				if (mainImage && newImage) {
					mainImage.setAttribute('src', newImage);

					// Update active state
					thumbnailButtons.forEach((btn) => btn.classList.remove('border-primary'));
					button.classList.add('border-primary');
				}
			});
		});

		// Set first thumbnail as active on load
		if (thumbnailButtons.length > 0) {
			thumbnailButtons[0].classList.add('border-primary');
		}
	</script>
</MainLayout>
