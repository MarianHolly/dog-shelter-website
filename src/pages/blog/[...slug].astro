---
import MainLayout from '@/layouts/main.astro';
import { getCollection, getEntry } from 'astro:content';

const { slug } = Astro.params;

if (!slug) {
	return Astro.redirect('/blog');
}

const postEntry = await getEntry('blog', slug as string);

if (!postEntry) {
	return Astro.redirect('/blog');
}

const post = postEntry.data;
const markdownBody = postEntry.body || '';

// Format date helper
const formatDate = (date: Date) => {
	return new Intl.DateTimeFormat('sk-SK', {
		year: 'numeric',
		month: 'long',
		day: 'numeric'
	}).format(date);
};

// Static paths
export async function getStaticPaths() {
	const posts = await getCollection('blog', ({ data }) => data.draft !== true);
	return posts.map((post) => ({
		params: { slug: post.id },
	}));
}
---

<MainLayout
	title={post.title}
	description={post.description}
	ogImage={post.image}
>
	<!-- Article Header -->
	<article class="article-content">
		<header class="article-header bg-muted/20">
			<div class="mx-auto max-w-4xl px-4 py-16">
				<div class="space-y-6">
					<!-- Category Badge -->
					{post.category && (
						<span class="inline-block px-4 py-2 text-sm font-semibold rounded-full bg-primary/10 text-primary">
							{post.category}
						</span>
					)}

					<!-- Title -->
					<h1 class="text-4xl md:text-5xl font-bold">{post.title}</h1>

					<!-- Meta Info -->
					<div class="flex flex-wrap items-center gap-4 text-muted-foreground">
						<span>{formatDate(post.pubDate)}</span>
						<span>•</span>
						<span>{post.author}</span>
						{post.updatedDate && (
							<>
								<span>•</span>
								<span class="text-sm">Aktualizované: {formatDate(post.updatedDate)}</span>
							</>
						)}
					</div>

					<!-- Tags -->
					{post.tags && post.tags.length > 0 && (
						<div class="flex flex-wrap gap-2">
							{post.tags.map((tag) => (
								<span class="text-sm px-3 py-1 rounded-full bg-secondary text-secondary-foreground">
									#{tag}
								</span>
							))}
						</div>
					)}
				</div>
			</div>
		</header>

		<!-- Featured Image -->
		{post.image && (
			<section class="featured-image">
				<div class="mx-auto max-w-5xl px-4 py-8">
					<img
						src={post.image}
						alt={post.imageAlt || post.title}
						class="w-full h-auto max-h-[600px] object-cover rounded-lg shadow-xl"
					/>
				</div>
			</section>
		)}

		<!-- Article Body -->
		<section class="article-body">
			<div class="mx-auto max-w-4xl px-4 py-12">
				<div class="prose prose-lg dark:prose-invert max-w-none">
					<div set:html={markdownBody} />
				</div>
			</div>
		</section>

		<!-- Back to Blog -->
		<section class="article-footer bg-muted/20">
			<div class="mx-auto max-w-4xl px-4 py-12 text-center">
				<a
					href="/blog"
					class="inline-flex items-center gap-2 px-6 py-3 rounded-md bg-primary text-primary-foreground hover:bg-primary/90 transition-colors font-semibold"
				>
					← Späť na blog
				</a>
			</div>
		</section>
	</article>
</MainLayout>

<style>
	.article-content {
		min-height: 60vh;
	}

	.prose {
		color: var(--tw-prose-body);
	}

	.prose h2 {
		margin-top: 2em;
		margin-bottom: 1em;
		font-size: 1.5em;
		font-weight: 700;
	}

	.prose h3 {
		margin-top: 1.6em;
		margin-bottom: 0.6em;
		font-size: 1.25em;
		font-weight: 600;
	}

	.prose p {
		margin-top: 1.25em;
		margin-bottom: 1.25em;
		line-height: 1.75;
	}

	.prose img {
		margin-top: 2em;
		margin-bottom: 2em;
		border-radius: 0.5rem;
	}

	.prose ul, .prose ol {
		margin-top: 1.25em;
		margin-bottom: 1.25em;
		padding-left: 1.625em;
	}

	.prose li {
		margin-top: 0.5em;
		margin-bottom: 0.5em;
	}

	.prose blockquote {
		margin-top: 1.6em;
		margin-bottom: 1.6em;
		padding-left: 1em;
		border-left: 0.25rem solid var(--tw-prose-quote-borders);
		font-style: italic;
	}
</style>
